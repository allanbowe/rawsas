---
title: 'Stripping Non-ASCII Characters within Macro'
date: '2016-09-08 17:50:00'
path: '/stripping-non-ascii-characters-within-macro/'
tags:
  - Movable Type
---

Hit <a href="http://rawsas.blogspot.co.uk/2016/09/reading-utf-8-in-filename-pipe.html" target="_blank">once more</a> with a pesky en-dash issue (likely related to the transcoding between SAS &amp; SQL Server) I discovered today there was no 'in-built' way to remove non-ascii (or extended-ascii) characters within SAS.<br /><br />There is a great SUGI paper about this topic (<a href="http://www.lexjansen.com/pharmasug/2010/CC/CC13.pdf" target="_blank">here</a>) but the approach required the use of a data step. &nbsp;Let me save you some fiddling around if you need this as a macro capability, with the extract below.<br /><br /><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><b><span style="background: white; color: navy; font-family: &quot;Courier New&quot;;">&nbsp; %macro</span></b><span style="background: white; font-family: &quot;Courier New&quot;;"> ascii();<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;</span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%local</span><span style="background: white; font-family: &quot;Courier New&quot;;"> i asciichars;<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;</span><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">/* adjust here to include any additional chars */</span><span style="background: white; font-family: &quot;Courier New&quot;;"><o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;</span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%do</span><span style="background: white; font-family: &quot;Courier New&quot;;"> i=</span><b><span style="background: white; color: teal; font-family: &quot;Courier New&quot;;">32</span></b><span style="background: white; font-family: &quot;Courier New&quot;;"> </span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%to</span><span style="background: white; font-family: &quot;Courier New&quot;;"> </span><b><span style="background: white; color: teal; font-family: &quot;Courier New&quot;;">126</span></b><span style="background: white; font-family: &quot;Courier New&quot;;">;<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%let</span><span style="background: white; font-family: &quot;Courier New&quot;;">asciichars=&amp;asciichars</span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%qsysfunc</span><span style="background: white; font-family: &quot;Courier New&quot;;">(byte(&amp;i));<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;</span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%end</span><span style="background: white; font-family: &quot;Courier New&quot;;">;<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;</span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%str</span><span style="background: white; font-family: &quot;Courier New&quot;;">(&amp;asciichars)<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><b><span style="background: white; color: navy; font-family: &quot;Courier New&quot;;">&nbsp; %mend</span></b><span style="background: white; font-family: &quot;Courier New&quot;;">;<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;"><br /></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">&nbsp; /* store in macvar for efficiency */</span><span style="background: white; font-family: &quot;Courier New&quot;;"><o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">&nbsp; %let</span><span style="background: white; font-family: &quot;Courier New&quot;;"> ascii_chars=%ascii();<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">&nbsp; %put</span><span style="background: white; font-family: &quot;Courier New&quot;;"> &amp;=ascii_chars;<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><br /></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">&nbsp; /**<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;* Example usage within macro language<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;*/</span><span style="background: white; font-family: &quot;Courier New&quot;;"><o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">&nbsp; %put</span><span style="background: white; font-family: &quot;Courier New&quot;;"> </span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">%sysfunc</span><span style="background: white; font-family: &quot;Courier New&quot;;">(compress(my – endash,&amp;ascii_chars,k ));<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><br /></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">&nbsp; /**<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;* Example usage within data step<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; color: green; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;*/</span><span style="background: white; font-family: &quot;Courier New&quot;;"><o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><b><span style="background: white; color: navy; font-family: &quot;Courier New&quot;;">&nbsp; data</span></b><span style="background: white; font-family: &quot;Courier New&quot;;"> </span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">_null_</span><span style="background: white; font-family: &quot;Courier New&quot;;">;<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;str=</span><span style="background: white; color: purple; font-family: &quot;Courier New&quot;;">"goodbye •–—˜™š›œžŸ&nbsp;¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶· nasties"</span><span style="background: white; font-family: &quot;Courier New&quot;;">;<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;asciichars=symget(</span><span style="background: white; color: purple; font-family: &quot;Courier New&quot;;">'ascii_chars'</span><span style="background: white; font-family: &quot;Courier New&quot;;">);<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp; out=compress(str,asciichars,</span><span style="background: white; color: purple; font-family: &quot;Courier New&quot;;">'k'</span><span style="background: white; font-family: &quot;Courier New&quot;;">);<o:p></o:p></span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><span style="background: white; font-family: &quot;Courier New&quot;;">&nbsp; &nbsp;&nbsp;</span><span style="background: white; color: blue; font-family: &quot;Courier New&quot;;">put</span><span style="background: white; font-family: &quot;Courier New&quot;;"> out=;</span></div><div style="margin: 0cm 0cm 0.0001pt 5.65pt;"><b><span style="background: white; color: navy; font-family: &quot;Courier New&quot;;">&nbsp; run</span></b><span style="background: white; font-family: &quot;Courier New&quot;;">;</span></div><div style="margin-left: 5.65pt;"><o:p></o:p></div><br />The main gotchas were as follows:<br /><br /><ul><li>The characters in byte(3,4,5,12,13) do funny things in macro (open code recursion etc)</li><li>It is not advisable to reference rank() above 127 as this extended set <a href="http://support.sas.com/documentation/cdl/en/hostwin/67962/HTML/default/viewer.htm#n1s18z766s30ddn1taghd7crnhsc.htm" target="_blank">can vary</a> country to country (the byte # may not be the same as the rank #)</li><li>The 32-126 range includes apostrophe and single quote, and thus they need to be handled appropriately!</li></ul><br />